import{c as _t}from"./main.js";function xt(Y,le){for(var K=0;K<le.length;K++){const X=le[K];if(typeof X!="string"&&!Array.isArray(X)){for(const J in X)if(J!=="default"&&!(J in Y)){const P=Object.getOwnPropertyDescriptor(X,J);P&&Object.defineProperty(Y,J,P.get?P:{enumerable:!0,get:()=>X[J]})}}}return Object.freeze(Object.defineProperty(Y,Symbol.toStringTag,{value:"Module"}))}var Te={exports:{}};(function(Y,le){((K,X)=>{Y.exports=X()})(_t,()=>{function K(){let m=0;const u={};this.register=i=>{const f=++m;return u[f]=i,f},this.unregister=i=>{const f=u[i];return delete u[i],f},this.setTimeout=(i,f)=>window.setTimeout(i,f),this.clearTimeout=i=>{window.clearTimeout(i)}}function X(){const m={};self.onmessage=u=>{const i=u.data,f=m[i.id];switch(i.type){case"setTimeout":m[i.id]=self.setTimeout(()=>{delete m[i.id],self.postMessage({id:i.id})},i.delay);break;case"clearTimeout":delete m[i.id],f&&self.clearTimeout(f);break;default:throw"Unknown command "+i.type}}}const J={isString:m=>m==null?!1:typeof m=="string"||m instanceof String};function P(){let m=[],u={};this.getTransportTypes=()=>m.slice(0),this.findTransportTypes=(i,f,r)=>{const a=[];for(let l=0;l<m.length;++l){const _=m[l];u[_].accept(i,f,r)===!0&&a.push(_)}return a},this.negotiateTransport=(i,f,r,a)=>{for(let l=0;l<m.length;++l){const _=m[l];for(let y=0;y<i.length;++y)if(_===i[y]){const b=u[_];if(b.accept(f,r,a)===!0)return b}}return null},this.add=(i,f,r)=>{let a=!1;for(let l=0;l<m.length;++l)if(m[l]===i){a=!0;break}return a||(typeof r!="number"?m.push(i):m.splice(r,0,i),u[i]=f),!a},this.find=i=>{for(let f=0;f<m.length;++f)if(m[f]===i)return u[i];return null},this.remove=i=>{for(let f=0;f<m.length;++f)if(m[f]===i){m.splice(f,1);const r=u[i];return delete u[i],r}return null},this.clear=()=>{m=[],u={}},this.reset=i=>{for(let f=0;f<m.length;++f)u[m[f]].reset(i)}}function Z(){let m,u,i;this.registered=(f,r)=>{m=f,u=r},this.unregistered=()=>{m=null,u=null},this._notifyTransportTimeout=function(f){const r=u._getTransportListeners("timeout");if(r)for(let a=0;a<r.length;++a){const l=r[a];try{const _=l.call(this,f);if(typeof _=="number"&&_>0)return _}catch(_){this._info("Exception during execution of transport listener",l,_)}}return 0},this._debug=function(){u._debug.apply(u,arguments)},this._info=function(){u._info.apply(u,arguments)},this._mixin=function(){return u._mixin.apply(u,arguments)},this.getConfiguration=()=>u.getConfiguration(),this.getAdvice=()=>u.getAdvice(),this.setTimeout=(f,r)=>u.setTimeout(f,r),this.clearTimeout=f=>{u.clearTimeout(f)},this.convertToJSON=function(f){const r=this.getConfiguration().maxSendBayeuxMessageSize;let a="[";for(let l=0;l<f.length;++l){l>0&&(a+=",");const _=f[l],y=JSON.stringify(_);if(y.length>r)throw"maxSendBayeuxMessageSize "+r+" exceeded";a+=y}return a+="]",a},this.convertToMessages=function(f){if(J.isString(f))try{return JSON.parse(f)}catch(r){throw this._debug("Could not convert to JSON the following string",'"'+f+'"'),r}if(Array.isArray(f))return f;if(f==null)return[];if(f instanceof Object)return[f];throw"Conversion Error "+f+", typeof "+typeof f},this.accept=(f,r,a)=>{throw"Abstract"},this.getType=()=>m,this.getURL=()=>i,this.setURL=f=>{i=f},this.send=(f,r)=>{throw"Abstract"},this.reset=function(f){this._debug("Transport",m,"reset",f?"initial":"retry")},this.abort=function(){this._debug("Transport",m,"aborted")},this.toString=function(){return this.getType()}}Z.derive=m=>{function u(){}return u.prototype=m,new u};function ue(){const m=new Z,u=Z.derive(m);let i=0,f=null,r=[],a=[];function l(h){for(;a.length>0;){const p=a[0],w=p[0],A=p[1];if(w.url===h.url&&w.sync===h.sync){a.shift(),h.messages=h.messages.concat(w.messages),this._debug("Coalesced",w.messages.length,"messages from request",A.id);continue}break}}function _(h,p,w){const A=this._notifyTransportTimeout(h.messages);if(A>0)this._debug("Transport",this.getType(),"extended waiting for message replies of request",p.id,":",A,"ms"),p.timeout=this.setTimeout(()=>{_.call(this,h,p,w+A)},A);else{p.expired=!0;const O="Transport "+this.getType()+" expired waiting for message replies of request "+p.id+": "+w+" ms",o={reason:O},d=p.xhr;o.httpCode=this.xhrStatus(d),this.abortXHR(d),this._debug(O),this.complete(p,!1,p.metaConnect),h.onFailure(d,h.messages,o)}}function y(h,p){if(this.transportSend(h,p)&&(p.expired=!1,!h.sync)){let w=this.getConfiguration().maxNetworkDelay;p.metaConnect===!0&&(w+=this.getAdvice().timeout),this._debug("Transport",this.getType(),"started waiting for message replies of request",p.id,":",w,"ms"),p.timeout=this.setTimeout(()=>{_.call(this,h,p,w)},w)}}function b(h){const p=++i,w={id:p,metaConnect:!1,envelope:h};r.length<this.getConfiguration().maxConnections-1?(r.push(w),y.call(this,h,w)):(this._debug("Transport",this.getType(),"queueing request",p,"envelope",h),a.push([h,w]))}function v(h){const p=h.id;if(this._debug("Transport",this.getType(),"/meta/connect complete, request",p),f!==null&&f.id!==p)throw"/meta/connect request mismatch, completing request "+p;f=null}function E(h,p){const w=r.indexOf(h);if(w>=0&&r.splice(w,1),a.length>0){const A=a.shift(),O=A[0],o=A[1];this._debug("Transport dequeued request",o.id),p?(this.getConfiguration().autoBatch&&l.call(this,O),b.call(this,O),this._debug("Transport completed request",h.id,O)):this.setTimeout(()=>{this.complete(o,!1,o.metaConnect);const d={reason:"Previous request failed"},C=o.xhr;d.httpCode=this.xhrStatus(C),O.onFailure(C,O.messages,d)},0)}}u.complete=function(h,p,w){w?v.call(this,h):E.call(this,h,p)},u.transportSend=(h,p)=>{throw"Abstract"},u.transportSuccess=function(h,p,w){p.expired||(this.clearTimeout(p.timeout),this._debug("Transport",this.getType(),"cancelled waiting for message replies"),this.complete(p,!0,p.metaConnect),w&&w.length>0?h.onSuccess(w):h.onFailure(p.xhr,h.messages,{httpCode:204}))},u.transportFailure=function(h,p,w){p.expired||(this.clearTimeout(p.timeout),this._debug("Transport",this.getType(),"cancelled waiting for failed message replies"),this.complete(p,!1,p.metaConnect),h.onFailure(p.xhr,h.messages,w))};function U(h){if(f!==null)throw"Concurrent /meta/connect requests not allowed, request id="+f.id+" not yet completed";const p=++i;this._debug("Transport",this.getType(),"/meta/connect send, request",p,"envelope",h);const w={id:p,metaConnect:!0,envelope:h};y.call(this,h,w),f=w}return u.send=function(h,p){p?U.call(this,h):b.call(this,h)},u.abort=function(){m.abort();for(let p=0;p<r.length;++p){const w=r[p];w&&(this._debug("Aborting request",w),this.abortXHR(w.xhr)||this.transportFailure(w.envelope,w,{reason:"abort"}))}const h=f;h&&(this._debug("Aborting /meta/connect request",h),this.abortXHR(h.xhr)||this.transportFailure(h.envelope,h,{reason:"abort"})),this.reset(!0)},u.reset=h=>{m.reset(h),f=null,r=[],a=[]},u.abortXHR=function(h){if(h)try{const p=h.readyState;return h.abort(),p!==window.XMLHttpRequest.UNSENT}catch(p){this._debug(p)}return!1},u.xhrStatus=function(h){if(h)try{return h.status}catch(p){this._debug(p)}return-1},u}function ye(){const m=new ue,u=Z.derive(m);let i=!0;u.accept=(r,a,l)=>i||!a,u.newXMLHttpRequest=()=>new window.XMLHttpRequest;function f(r){try{r.context=u.context}catch(a){u._debug("Could not copy transport context into XHR",a)}}return u.xhrSend=r=>{const a=u.newXMLHttpRequest();f(a),a.withCredentials=!0,a.open("POST",r.url,r.sync!==!0);const l=r.headers;if(l)for(let _ in l)l.hasOwnProperty(_)&&a.setRequestHeader(_,l[_]);return a.setRequestHeader("Content-Type","application/json;charset=UTF-8"),a.onload=()=>{a.status===200?r.onSuccess(a.responseText):r.onError(a.statusText)},a.onabort=a.onerror=()=>{r.onError(a.statusText)},a.send(r.body),a},u.transportSend=function(r,a){this._debug("Transport",this.getType(),"sending request",a.id,"envelope",r);try{let l=!0;return a.xhr=this.xhrSend({transport:this,url:r.url,sync:r.sync,headers:this.getConfiguration().requestHeaders,body:this.convertToJSON(r.messages),onSuccess:_=>{this._debug("Transport",this.getType(),"received response",_);let y=!1;try{const b=this.convertToMessages(_);b.length===0?(i=!1,this.transportFailure(r,a,{httpCode:204})):(y=!0,this.transportSuccess(r,a,b))}catch(b){if(this._debug(b),!y){i=!1;const v={exception:b};v.httpCode=this.xhrStatus(a.xhr),this.transportFailure(r,a,v)}}},onError:(_,y)=>{this._debug("Transport",this.getType(),"received error",_,y),i=!1;const b={reason:_,exception:y};b.httpCode=this.xhrStatus(a.xhr),l?this.setTimeout(()=>{this.transportFailure(r,a,b)},0):this.transportFailure(r,a,b)}}),l=!1,!0}catch(l){return this._debug("Transport",this.getType(),"exception:",l),i=!1,this.setTimeout(()=>{this.transportFailure(r,a,{exception:l})},0),!1}},u.reset=r=>{m.reset(r),i=!0},u}function we(){const m=new ue,u=Z.derive(m);let i=0;u.accept=(r,a,l)=>!0,u.jsonpSend=r=>{const a=document.getElementsByTagName("head")[0],l=document.createElement("script"),_="_cometd_jsonp_"+i++;window[_]=b=>{a.removeChild(l),delete window[_],r.onSuccess(b)};let y=r.url;y+=y.indexOf("?")<0?"?":"&",y+="jsonp="+_,y+="&message="+encodeURIComponent(r.body),l.src=y,l.async=r.sync!==!0,l.type="application/javascript",l.onerror=b=>{r.onError("jsonp "+b.type)},a.appendChild(l)};function f(r,a,l){return()=>{this.transportFailure(r,a,"error",l)}}return u.transportSend=function(r,a){let l=0,_=r.messages.length;const y=[];for(;_>0;){const v=JSON.stringify(r.messages.slice(l,l+_)),E=r.url.length+encodeURI(v).length,U=this.getConfiguration().maxURILength;if(E>U){if(_===1){const h="Bayeux message too big ("+E+" bytes, max is "+U+") for transport "+this.getType();this.setTimeout(f.call(this,r,a,h),0);return}--_;continue}y.push(_),l+=_,_=r.messages.length-l}let b=r;if(y.length>1){let v=0,E=y[0];this._debug("Transport",this.getType(),"split",r.messages.length,"messages into",y.join(" + ")),b=this._mixin(!1,{},r),b.messages=r.messages.slice(v,E),b.onSuccess=r.onSuccess,b.onFailure=r.onFailure;for(let U=1;U<y.length;++U){const h=this._mixin(!1,{},r);v=E,E+=y[U],h.messages=r.messages.slice(v,E),h.onSuccess=r.onSuccess,h.onFailure=r.onFailure,this.send(h,a.metaConnect)}}this._debug("Transport",this.getType(),"sending request",a.id,"envelope",b);try{let v=!0;return this.jsonpSend({transport:this,url:b.url,sync:b.sync,headers:this.getConfiguration().requestHeaders,body:JSON.stringify(b.messages),onSuccess:E=>{let U=!1;try{const h=this.convertToMessages(E);h.length===0?this.transportFailure(b,a,{httpCode:204}):(U=!0,this.transportSuccess(b,a,h))}catch(h){this._debug(h),U||this.transportFailure(b,a,{exception:h})}},onError:(E,U)=>{const h={reason:E,exception:U};v?this.setTimeout(()=>{this.transportFailure(b,a,h)},0):this.transportFailure(b,a,h)}}),v=!1,!0}catch(v){return this.setTimeout(()=>{this.transportFailure(b,a,{exception:v})},0),!1}},u}function ke(){const m=new Z,u=Z.derive(m);let i,f=!0,r=!1,a=!0,l=null,_=null,y=!1,b=null;u.reset=o=>{m.reset(o),f=!0,o&&(r=!1),a=!0,o&&(l=null),_=null,y=!1};function v(o,d){o&&(this.webSocketClose(o,d.code,d.reason),this.onClose(o,d))}function E(o){return o===_||o===l}function U(o,d,C){const k=[];for(let L=0;L<d.messages.length;++L){const M=d.messages[L];M.id&&k.push(M.id)}o.envelopes[k.join(",")]=[d,C],this._debug("Transport",this.getType(),"stored envelope, envelopes",o.envelopes)}function h(o,d){let C=!1;const k=o.envelopes;for(let L=0;L<d.length;++L){const M=d[L];for(let S in k)if(k.hasOwnProperty(S)){const B=S.split(","),N=B.indexOf(M);if(N>=0){C=!0,B.splice(N,1);const W=k[S][0],$=k[S][1];delete k[S],B.length>0&&(k[B.join(",")]=[W,$]);break}}}C&&this._debug("Transport",this.getType(),"removed envelope, envelopes",k)}function p(o){if(_)return;const d=i.getURL().replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",d);try{const S=i.getConfiguration().protocol;o.webSocket=S?new window.WebSocket(d,S):new window.WebSocket(d),_=o}catch(S){throw f=!1,this._debug("Exception while creating WebSocket object",S),S}a=i.getConfiguration().stickyReconnect!==!1;const C=i.getConfiguration().connectTimeout;C>0&&(o.connectTimer=this.setTimeout(()=>{i._debug("Transport",this.getType(),"timed out while connecting to URL",d,":",C,"ms"),v.call(this,o,{code:1e3,reason:"Connect Timeout"})},C));const k=()=>{i._debug("WebSocket onopen",o),o.connectTimer&&this.clearTimeout(o.connectTimer),E(o)?(_=null,l=o,r=!0,this.onOpen(o)):(i._warn("Closing extra WebSocket connection",this,"active connection",l),v.call(this,o,{code:1e3,reason:"Extra Connection"}))},L=S=>{S=S||{code:1e3},i._debug("WebSocket onclose",o,S,"connecting",_,"current",l),o.connectTimer&&this.clearTimeout(o.connectTimer),this.onClose(o,S)},M=S=>{i._debug("WebSocket onmessage",S,o),this.onMessage(o,S)};o.webSocket.onopen=k,o.webSocket.onclose=L,o.webSocket.onerror=()=>{L({code:1e3,reason:"Error"})},o.webSocket.onmessage=M,this._debug("Transport",this.getType(),"configured callbacks on",o)}function w(o,d,C){const k=this._notifyTransportTimeout([d]);k>0?(this._debug("Transport",this.getType(),"extended waiting for message replies:",k,"ms"),o.timeouts[d.id]=this.setTimeout(()=>{w.call(this,o,d,C+k)},k)):(this._debug("Transport",this.getType(),"expired waiting for message reply",d.id,":",C,"ms"),v.call(this,o,{code:1e3,reason:"Message Timeout"}))}function A(o,d,C){let k;try{k=this.convertToJSON(d.messages)}catch(S){this._debug("Transport",this.getType(),"exception:",S);const B=[];for(let N=0;N<d.messages.length;++N){const W=d.messages[N];B.push(W.id)}h.call(this,o,B),this.setTimeout(()=>{this._notifyFailure(d.onFailure,o,d.messages,{exception:S})},0);return}o.webSocket.send(k),this._debug("Transport",this.getType(),"sent",d,"/meta/connect =",C);let L=this.getConfiguration().maxNetworkDelay;C&&(L+=this.getAdvice().timeout,y=!0);const M=[];for(let S=0;S<d.messages.length;++S){const B=d.messages[S];B.id&&(M.push(B.id),o.timeouts[B.id]=this.setTimeout(()=>{w.call(this,o,B,L)},L))}this._debug("Transport",this.getType(),"started waiting for message replies",L,"ms, messageIds:",M,", timeouts:",o.timeouts)}u._notifySuccess=function(o,d){o.call(this,d)},u._notifyFailure=function(o,d,C,k){o.call(this,d,C,k)};function O(o,d,C){try{o===null?(o=_||{envelopes:{},timeouts:{}},U.call(this,o,d,C),p.call(this,o)):(U.call(this,o,d,C),A.call(this,o,d,C))}catch(k){this.setTimeout(()=>{v.call(this,o,{code:1e3,reason:"Exception",exception:k})},0)}}return u.onOpen=function(o){const d=o.envelopes;this._debug("Transport",this.getType(),"opened",o,"pending messages",d);for(let C in d)if(d.hasOwnProperty(C)){const k=d[C],L=k[0],M=k[1];b=L.onSuccess,A.call(this,o,L,M)}},u.onMessage=function(o,d){this._debug("Transport",this.getType(),"received websocket message",d,o);let C=!1;const k=this.convertToMessages(d.data),L=[];for(let M=0;M<k.length;++M){const S=k[M];if((/^\/meta\//.test(S.channel)||S.data===void 0)&&S.id){L.push(S.id);const B=o.timeouts[S.id];B&&(this.clearTimeout(B),delete o.timeouts[S.id],this._debug("Transport",this.getType(),"removed timeout for message",S.id,", timeouts",o.timeouts))}S.channel==="/meta/connect"&&(y=!1),S.channel==="/meta/disconnect"&&!y&&(C=!0)}h.call(this,o,L),this._notifySuccess(b,k),C&&this.webSocketClose(o,1e3,"Disconnect")},u.onClose=function(o,d){this._debug("Transport",this.getType(),"closed",o,d),E(o)&&(f=a&&r,_=null,l=null);const C=o.timeouts;o.timeouts={};for(let L in C)C.hasOwnProperty(L)&&this.clearTimeout(C[L]);const k=o.envelopes;o.envelopes={};for(let L in k)if(k.hasOwnProperty(L)){const M=k[L][0];k[L][1]&&(y=!1);const B={websocketCode:d.code,reason:d.reason};d.exception&&(B.exception=d.exception),this._notifyFailure(M.onFailure,o,M.messages,B)}},u.registered=(o,d)=>{m.registered(o,d),i=d},u.accept=function(o,d,C){return this._debug("Transport",this.getType(),"accept, supported:",f),f&&!!window.WebSocket&&i.websocketEnabled!==!1},u.send=function(o,d){this._debug("Transport",this.getType(),"sending",o,"/meta/connect =",d),O.call(this,l,o,d)},u.webSocketClose=function(o,d,C){try{o.webSocket&&o.webSocket.close(d,C)}catch(k){this._debug(k)}},u.abort=function(){m.abort(),v.call(this,l,{code:1e3,reason:"Abort"}),this.reset(!0)},u}function Ve(m){const u=new K,i=this,f=m||"default";let r=!1;const a=new P;let l,_="disconnected",y=0,b=null,v=0,E=[],U=!1,h=0,p={};const w={};let A=0,O=null;const o=[];let d={},C,k;const L={},M={};let S=!1,B=!1,N=0,W=0,$=null,I={useWorkerScheduler:!0,protocol:null,stickyReconnect:!0,connectTimeout:0,maxConnections:2,backoffIncrement:1e3,maxBackoff:6e4,logLevel:"info",maxNetworkDelay:1e4,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,urls:{},maxURILength:2e3,maxSendBayeuxMessageSize:8192,advice:{timeout:6e4,interval:0,reconnect:void 0,maxInterval:0}};function Se(e,t){try{return e[t]}catch{return}}this._mixin=function(e,t,n){const s=t||{};for(let c=2;c<arguments.length;++c){const g=arguments[c];if(g!=null){for(let x in g)if(g.hasOwnProperty(x)){const T=Se(g,x),F=Se(s,x);if(T===t||T===void 0)continue;if(e&&typeof T=="object"&&T!==null)if(T instanceof Array)s[x]=this._mixin(e,F instanceof Array?F:[],T);else{const H=typeof F=="object"&&!(F instanceof Array)?F:{};s[x]=this._mixin(e,H,T)}else s[x]=T}}}return s};function G(e){return J.isString(e)}function $e(e){return e>="A"&&e<="Z"?!0:e>="a"&&e<="z"}function Ge(e){return e>="0"&&e<="9"}function Qe(e){switch(e){case" ":case"!":case"#":case"$":case"(":case")":case"*":case"+":case"-":case".":case"/":case"@":case"_":case"{":case"~":case"}":return!0;default:return!1}}function de(e){if(!G(e)||e.length<2||e.charAt(0)!=="/")return!1;for(let t=1;t<e.length;++t){const n=e.charAt(t);if(!($e(n)||Ge(n)||Qe(n)))return!1}return!0}function R(e){return e==null?!1:typeof e=="function"}function se(e,t){let n="";for(;--t>0&&!(e>=Math.pow(10,t));)n+="0";return n+=e,n}function he(e,t){if(window.console){const n=window.console[e];if(R(n)){const s=new Date;[].splice.call(t,0,0,se(s.getHours(),2)+":"+se(s.getMinutes(),2)+":"+se(s.getSeconds(),2)+"."+se(s.getMilliseconds(),3)),n.apply(window.console,t)}}}this._warn=function(){he("warn",arguments)},this._info=function(){I.logLevel!=="warn"&&he("info",arguments)},this._debug=function(){I.logLevel==="debug"&&he("debug",arguments)};function ge(e){return new RegExp("(^https?://)?(((\\[[^\\]]+])|([^:/?#]+))(:(\\d+))?)?([^?#]*)(.*)?").exec(e)}this._isCrossDomain=e=>window.location&&window.location.host&&e?e!==window.location.host:!1;function Ke(e){i._debug("Configuring cometd object with",e),G(e)&&(e={url:e}),e||(e={}),I=i._mixin(!1,I,e);const t=i.getURL();if(!t)throw"Missing required configuration parameter 'url' specifying the Bayeux server URL";const n=ge(t),s=n[2],c=n[8],g=n[9];if(r=i._isCrossDomain(s),I.appendMessageTypeToURL)if(g!==void 0&&g.length>0)i._info("Appending message type to URI "+c+g+" is not supported, disabling 'appendMessageTypeToURL' configuration"),I.appendMessageTypeToURL=!1;else{const x=c.split("/");let T=x.length-1;c.match(/\/$/)&&(T-=1),x[T].indexOf(".")>=0&&(i._info("Appending message type to URI "+c+" is not supported, disabling 'appendMessageTypeToURL' configuration"),I.appendMessageTypeToURL=!1)}if(window.Worker&&window.Blob&&window.URL&&I.useWorkerScheduler){let x=X.toString();x=x.substring(x.indexOf("{")+1,x.lastIndexOf("}"));const T=new window.Blob([x],{type:"application/json"}),F=window.URL.createObjectURL(T),H=new window.Worker(F);u.setTimeout=(q,ae)=>{const ie=u.register(q);return H.postMessage({id:ie,type:"setTimeout",delay:ae}),ie},u.clearTimeout=q=>{u.unregister(q),H.postMessage({id:q,type:"clearTimeout"})},H.onmessage=q=>{const ae=q.data.id,ie=u.unregister(ae);ie&&ie()}}}function Ce(e){if(e){const t=p[e.channel];t&&t[e.id]&&(delete t[e.id],i._debug("Removed",e.listener?"listener":"subscription",e))}}function Re(e){e&&!e.listener&&Ce(e)}function ve(){for(let e in p)if(p.hasOwnProperty(e)){const t=p[e];if(t)for(let n in t)t.hasOwnProperty(n)&&Re(t[n])}}function Q(e){_!==e&&(i._debug("Status",_,"->",e),_=e)}function j(){return _==="disconnecting"||_==="disconnected"}function V(){return""+ ++y}function Le(e,t,n,s,c){try{return t.call(e,s)}catch(g){const x=i.onExtensionException;if(R(x)){i._debug("Invoking extension exception handler",n,g);try{x.call(i,g,n,c,s)}catch(T){i._info("Exception during execution of extension exception handler",n,T)}}else i._info("Exception during execution of extension",n,g);return s}}function Ye(e){for(let t=0;t<o.length&&e!=null;++t){const n=o[t],s=n.extension.incoming;if(R(s)){const c=Le(n.extension,s,n.name,e,!1);e=c===void 0?e:c}}return e}function Pe(e){for(let t=o.length-1;t>=0&&e!=null;--t){const n=o[t],s=n.extension.outgoing;if(R(s)){const c=Le(n.extension,s,n.name,e,!0);e=c===void 0?e:c}}return e}function pe(e,t){const n=p[e];if(n){for(let s in n)if(n.hasOwnProperty(s)){const c=n[s];if(c)try{c.callback.call(c.scope,t)}catch(g){const x=i.onListenerException;if(R(x)){i._debug("Invoking listener exception handler",c,g);try{x.call(i,g,c,c.listener,t)}catch(T){i._info("Exception during execution of listener exception handler",c,T)}}else i._info("Exception during execution of listener",c,t,g)}}}}function D(e,t){pe(e,t);const n=e.split("/"),s=n.length-1;for(let c=s;c>0;--c){let g=n.slice(0,c).join("/")+"/*";c===s&&pe(g,t),g+="*",pe(g,t)}}function Ee(){O!==null&&i.clearTimeout(O),O=null}function Fe(e,t){Ee();const n=d.interval+t;i._debug("Function scheduled in",n,"ms, interval =",d.interval,"backoff =",A,e),O=i.setTimeout(e,n)}let Ue,me;function ee(e,t,n){for(let g=0;g<e.length;++g){let x=e[g];const T=x.id;b&&(x.clientId=b),x=Pe(x),x!=null?(x.id=T,e[g]=x):(delete L[T],e.splice(g--,1))}if(e.length===0)return;t&&($=e[0]);let s=i.getURL();I.appendMessageTypeToURL&&(s.match(/\/$/)||(s=s+"/"),n&&(s=s+n));const c={url:s,sync:!1,messages:e,onSuccess:g=>{try{Ue.call(i,g)}catch(x){i._info("Exception during handling of messages",x)}},onFailure:(g,x,T)=>{try{const F=i.getTransport();T.connectionType=F?F.getType():"unknown",me.call(i,g,x,T)}catch(F){i._info("Exception during handling of failure",F)}}};i._debug("Send",c),l.send(c,t)}function te(e){v>0||U===!0?E.push(e):ee([e],!1)}this.send=te;function oe(){A=0}function et(){return A<I.maxBackoff&&(A+=I.backoffIncrement),A}function tt(){++v,i._debug("Starting batch, depth",v)}function Be(){const e=E;E=[],e.length>0&&ee(e,!1)}function nt(){if(--v,i._debug("Ending batch, depth",v),v<0)throw"Calls to startBatch() and endBatch() are not paired";v===0&&!j()&&!U&&Be()}function it(){if(!j()){const e={id:V(),channel:"/meta/connect",connectionType:l.getType()};B||(e.advice={timeout:0}),Q("connecting"),i._debug("Connect sent",e),ee([e],!0,"connect"),Q("connected")}}function re(e){Q("connecting"),Fe(()=>{it()},e)}function Ie(e){e&&(d=i._mixin(!1,{},I.advice,e),i._debug("New advice",d))}function ne(e){if(Ee(),e&&l&&l.abort(),r=!1,l=null,Q("disconnected"),b=null,v=0,oe(),S=!1,B=!1,N=0,$=null,E.length>0){const t=E;E=[],me.call(i,void 0,t,{reason:"Disconnected"})}}function _e(e,t,n){const s=i.onTransportException;if(R(s)){i._debug("Invoking transport exception handler",e,t,n);try{s.call(i,n,e,t)}catch(c){i._info("Exception during execution of transport exception handler",c)}}}function Me(e,t){R(e)&&(t=e,e=void 0),b=null,ve(),j()&&a.reset(!0),Ie({}),v=0,U=!0,C=e,k=t;const n="1.0",s=i.getURL(),c=a.findTransportTypes(n,r,s),g={id:V(),version:n,minimumVersion:n,channel:"/meta/handshake",supportedConnectionTypes:c,advice:{timeout:d.timeout,interval:d.interval}},x=i._mixin(!1,{},C,g);if(i._putCallback(x.id,t),!l&&(l=a.negotiateTransport(c,n,r,s),!l)){const T="Could not find initial transport among: "+a.getTransportTypes();throw i._warn(T),T}i._debug("Initial transport is",l.getType()),Q("handshaking"),i._debug("Handshake sent",x),ee([x],!1,"handshake")}function st(e){Q("handshaking"),U=!0,Fe(()=>{Me(C,k)},e)}function ce(e,t){try{e.call(i,t)}catch(n){const s=i.onCallbackException;if(R(s)){i._debug("Invoking callback exception handler",n);try{s.call(i,n,t)}catch(c){i._info("Exception during execution of callback exception handler",c)}}else i._info("Exception during execution of message callback",n)}}this._getCallback=e=>L[e],this._putCallback=function(e,t){const n=this._getCallback(e);return R(t)&&(L[e]=t),n};function z(e){const t=i._getCallback([e.id]);R(t)&&(delete L[e.id],ce(t,e))}function Ae(e){const t=M[e.id];if(delete M[e.id],t){i._debug("Handling remote call response for",e,"with context",t);const n=t.timeout;n&&i.clearTimeout(n);const s=t.callback;if(R(s))return ce(s,e),!0}return!1}this.onTransportFailure=function(e,t,n){this._debug("Transport failure",t,"for",e);const s=this.getTransportRegistry(),c=this.getURL(),g=this._isCrossDomain(ge(c)[2]),x="1.0",T=s.findTransportTypes(x,g,c);if(t.action==="none"){if(e.channel==="/meta/handshake"&&!t.transport){const F="Could not negotiate transport, client=["+T+"], server=["+e.supportedConnectionTypes+"]";this._warn(F),_e(l.getType(),null,{reason:F,connectionType:l.getType(),transport:l})}}else if(t.delay=this.getBackoffPeriod(),e.channel==="/meta/handshake"){if(!t.transport){const F=l?l.getType():null,H=s.negotiateTransport(T,x,g,c);if(!H)this._warn("Could not negotiate transport, client=["+T+"]"),_e(F,null,e.failure),t.action="none";else{const q=H.getType();this._debug("Transport",F,"->",q),_e(F,q,e.failure),t.action="handshake",t.transport=H}}t.action!=="none"&&this.increaseBackoffPeriod()}else{const F=new Date().getTime();if(N===0&&(N=F),t.action==="retry"){t.delay=this.increaseBackoffPeriod();const H=d.maxInterval;if(H>0){const q=d.timeout+d.interval+H;F-N+A>q&&(t.action="handshake")}}t.action==="handshake"&&(t.delay=0,s.reset(!1),this.resetBackoffPeriod())}n.call(i,t)};function De(e){i._debug("Transport failure handling",e),e.transport&&(l=e.transport),e.url&&l.setURL(e.url);const t=e.action,n=e.delay||0;switch(t){case"handshake":st(n);break;case"retry":re(n);break;case"none":ne(!0);break;default:throw"Unknown action "+t}}function xe(e,t){z(e),D("/meta/handshake",e),D("/meta/unsuccessful",e),j()&&(t.action="none"),i.onTransportFailure.call(i,e,t,De)}function ot(e){const t=i.getURL();if(e.successful){const n=i._isCrossDomain(ge(t)[2]),s=a.negotiateTransport(e.supportedConnectionTypes,e.version,n,t);if(s===null){e.successful=!1,xe(e,{cause:"negotiation",action:"none",transport:null});return}else l!==s&&(i._debug("Transport",l.getType(),"->",s.getType()),l=s);b=e.clientId,U=!1,Be(),e.reestablish=S,S=!0,z(e),D("/meta/handshake",e),W=e["x-messages"]||0;const c=j()?"none":d.reconnect||"retry";switch(c){case"retry":oe(),W===0?re(0):i._debug("Processing",W,"handshake-delivered messages");break;case"none":ne(!0);break;default:throw"Unrecognized advice action "+c}}else xe(e,{cause:"unsuccessful",action:d.reconnect||"handshake",transport:l})}function rt(e){xe(e,{cause:"failure",action:"handshake",transport:null})}function Oe(e){return _==="disconnected"?!0:$&&$.id===e.id?($=null,!0):!1}function je(e,t){D("/meta/connect",e),D("/meta/unsuccessful",e),j()&&(t.action="none"),i.onTransportFailure.call(i,e,t,De)}function ct(e){if(Oe(e))if(B=e.successful,B){D("/meta/connect",e);const t=j()?"none":d.reconnect||"retry";switch(t){case"retry":oe(),re(A);break;case"none":ne(!1);break;default:throw"Unrecognized advice action "+t}}else je(e,{cause:"unsuccessful",action:d.reconnect||"retry",transport:l});else i._debug("Mismatched /meta/connect reply",e)}function at(e){Oe(e)?(B=!1,je(e,{cause:"failure",action:"retry",transport:null})):i._debug("Mismatched /meta/connect failure",e)}function Ne(e){ne(!0),z(e),D("/meta/disconnect",e),D("/meta/unsuccessful",e)}function lt(e){e.successful?(ne(!1),z(e),D("/meta/disconnect",e)):Ne(e)}function ut(e){Ne(e)}function He(e){const t=p[e.subscription];if(t){for(let n in t)if(t.hasOwnProperty(n)){const s=t[n];s&&!s.listener&&(delete t[n],i._debug("Removed failed subscription",s))}}z(e),D("/meta/subscribe",e),D("/meta/unsuccessful",e)}function ft(e){e.successful?(z(e),D("/meta/subscribe",e)):He(e)}function dt(e){He(e)}function qe(e){z(e),D("/meta/unsubscribe",e),D("/meta/unsuccessful",e)}function ht(e){e.successful?(z(e),D("/meta/unsubscribe",e)):qe(e)}function gt(e){qe(e)}function be(e){Ae(e)||(z(e),D("/meta/publish",e),D("/meta/unsuccessful",e))}function pt(e){e.data!==void 0?Ae(e)||(D(e.channel,e),W>0&&(--W,W===0&&(i._debug("Processed last handshake-delivered message"),re(0)))):e.successful===void 0?i._warn("Unknown Bayeux Message",e):e.successful?(z(e),D("/meta/publish",e)):be(e)}function mt(e){be(e)}function We(e){if(N=0,e=Ye(e),e==null)return;switch(Ie(e.advice),e.channel){case"/meta/handshake":ot(e);break;case"/meta/connect":ct(e);break;case"/meta/disconnect":lt(e);break;case"/meta/subscribe":ft(e);break;case"/meta/unsubscribe":ht(e);break;default:pt(e);break}}this.receive=We,Ue=e=>{i._debug("Received",e);for(let t=0;t<e.length;++t){const n=e[t];We(n)}},me=(e,t,n)=>{i._debug("handleFailure",e,t,n),n.transport=e;for(let s=0;s<t.length;++s){const c=t[s],g={id:c.id,successful:!1,channel:c.channel,failure:n};switch(n.message=c,c.channel){case"/meta/handshake":rt(g);break;case"/meta/connect":at(g);break;case"/meta/disconnect":ut(g);break;case"/meta/subscribe":g.subscription=c.subscription,dt(g);break;case"/meta/unsubscribe":g.subscription=c.subscription,gt(g);break;default:mt(g);break}}};function ze(e){const t=p[e];if(t){for(let n in t)if(t.hasOwnProperty(n)&&t[n])return!0}return!1}function Xe(e,t){const n={scope:e,method:t};if(R(e))n.scope=void 0,n.method=e;else if(G(t)){if(!e)throw"Invalid scope "+e;if(n.method=e[t],!R(n.method))throw"Invalid callback "+t+" for scope "+e}else if(!R(t))throw"Invalid callback "+t;return n}function Je(e,t,n,s){const c=Xe(t,n);i._debug("Adding",s?"listener":"subscription","on",e,"with scope",c.scope,"and callback",c.method);const g=++h,x={id:g,channel:e,scope:c.scope,callback:c.method,listener:s};let T=p[e];return T||(T={},p[e]=T),T[g]=x,i._debug("Added",s?"listener":"subscription",x),x}this.registerTransport=function(e,t,n){const s=a.add(e,t,n);return s&&(this._debug("Registered transport",e),R(t.registered)&&t.registered(e,this)),s},this.unregisterTransport=function(e){const t=a.remove(e);return t!==null&&(this._debug("Unregistered transport",e),R(t.unregistered)&&t.unregistered()),t},this.unregisterTransports=()=>{a.clear()},this.getTransportTypes=()=>a.getTransportTypes(),this.findTransport=e=>a.find(e),this.getTransportRegistry=()=>a,this.configure=function(e){Ke.call(this,e)},this.init=function(e,t){this.configure(e),this.handshake(t)},this.handshake=(e,t)=>{if(_!=="disconnected")throw"Illegal state: handshaken";Me(e,t)},this.disconnect=function(e,t){if(j())return;R(e)&&(t=e,e=void 0);const n={id:V(),channel:"/meta/disconnect"},s=this._mixin(!1,{},e,n);i._putCallback(s.id,t),Q("disconnecting"),ee([s],!1,"disconnect")},this.startBatch=()=>{tt()},this.endBatch=()=>{nt()},this.batch=function(e,t){const n=Xe(e,t);this.startBatch();try{n.method.call(n.scope),this.endBatch()}catch(s){throw this._info("Exception during execution of batch",s),this.endBatch(),s}},this.addTransportListener=(e,t)=>{if(e!=="timeout")throw"Unsupported event "+e;let n=w[e];n||(w[e]=n=[]),n.push(t)},this.removeTransportListener=(e,t)=>{const n=w[e];if(n){const s=n.indexOf(t);if(s>=0)return n.splice(s,1),!0}return!1},this._getTransportListeners=e=>w[e],this.addListener=function(e,t,n){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!G(e))throw"Illegal argument type: channel must be a string";return Je(e,t,n,!0)},this.removeListener=e=>{if(!e||!e.channel||!("id"in e))throw"Invalid argument: expected subscription, not "+e;Ce(e)},this.clearListeners=()=>{p={}},this.subscribe=function(e,t,n,s,c){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!de(e))throw"Illegal argument: invalid channel "+e;if(j())throw"Illegal state: disconnected";R(t)&&(c=s,s=n,n=t,t=void 0),R(s)&&(c=s,s=void 0);const g=!ze(e),x=Je(e,t,n,!1);if(g){const T={id:V(),channel:"/meta/subscribe",subscription:e},F=this._mixin(!1,{},s,T);i._putCallback(F.id,c),te(F)}else R(c)&&i.setTimeout(()=>{ce(c,{id:V(),successful:!0,channel:"/meta/subscribe",subscription:e})},0);return x},this.unsubscribe=function(e,t,n){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(j())throw"Illegal state: disconnected";R(t)&&(n=t,t=void 0),this.removeListener(e);const s=e.channel;if(ze(s))R(n)&&i.setTimeout(()=>{ce(n,{id:V(),successful:!0,channel:"/meta/unsubscribe",subscription:s})},0);else{const c={id:V(),channel:"/meta/unsubscribe",subscription:s},g=this._mixin(!1,{},t,c);i._putCallback(g.id,n),te(g)}},this.resubscribe=function(e,t){if(Re(e),e)return this.subscribe(e.channel,e.scope,e.callback,t)},this.clearSubscriptions=()=>{ve()},this.publish=function(e,t,n,s){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!de(e))throw"Illegal argument: invalid channel "+e;if(/^\/meta\//.test(e))throw"Illegal argument: cannot publish to meta channels";if(j())throw"Illegal state: disconnected";R(t)?(s=t,t={},n=void 0):R(n)&&(s=n,n=void 0);const c={id:V(),channel:e,data:t},g=this._mixin(!1,{},n,c);i._putCallback(g.id,s),te(g)},this.publishBinary=function(e,t,n,s,c,g){R(t)?(g=t,t=new ArrayBuffer(0),n=!0,s=void 0,c=void 0):R(n)?(g=n,n=!0,s=void 0,c=void 0):R(s)?(g=s,s=void 0,c=void 0):R(c)&&(g=c,c=void 0);const x={meta:s,data:t,last:n},T=this._mixin(!1,c,{ext:{binary:{}}});this.publish(e,x,T,g)},this.remoteCall=function(e,t,n,s,c){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!G(e))throw"Illegal argument type: target must be a string";if(j())throw"Illegal state: disconnected";if(R(t)?(c=t,t={},n=I.maxNetworkDelay,s=void 0):R(n)?(c=n,n=I.maxNetworkDelay,s=void 0):R(s)&&(c=s,s=void 0),typeof n!="number")throw"Illegal argument type: timeout must be a number";e.match(/^\//)||(e="/"+e);const g="/service"+e;if(!de(g))throw"Illegal argument: invalid target "+e;const x={id:V(),channel:g,data:t},T=this._mixin(!1,{},s,x),F={callback:c};n>0&&(F.timeout=i.setTimeout(()=>{i._debug("Timing out remote call",T,"after",n,"ms"),be({id:T.id,error:"406::timeout",successful:!1,failure:{message:T,reason:"Remote Call Timeout"}})},n),i._debug("Scheduled remote call timeout",T,"in",n,"ms")),M[T.id]=F,te(T)},this.remoteCallBinary=function(e,t,n,s,c,g,x){R(t)?(x=t,t=new ArrayBuffer(0),n=!0,s=void 0,c=I.maxNetworkDelay,g=void 0):R(n)?(x=n,n=!0,s=void 0,c=I.maxNetworkDelay,g=void 0):R(s)?(x=s,s=void 0,c=I.maxNetworkDelay,g=void 0):R(c)?(x=c,c=I.maxNetworkDelay,g=void 0):R(g)&&(x=g,g=void 0);const T={meta:s,data:t,last:n},F=this._mixin(!1,g,{ext:{binary:{}}});this.remoteCall(e,T,c,F,x)},this.getStatus=()=>_,this.isDisconnected=j,this.setBackoffIncrement=e=>{I.backoffIncrement=e},this.getBackoffIncrement=()=>I.backoffIncrement,this.getBackoffPeriod=()=>A,this.increaseBackoffPeriod=()=>et(),this.resetBackoffPeriod=()=>{oe()},this.setLogLevel=e=>{I.logLevel=e},this.registerExtension=function(e,t){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!G(e))throw"Illegal argument type: extension name must be a string";let n=!1;for(let s=0;s<o.length;++s)if(o[s].name===e){n=!0;break}return n?(this._info("Could not register extension with name",e,"since another extension with the same name already exists"),!1):(o.push({name:e,extension:t}),this._debug("Registered extension",e),R(t.registered)&&t.registered(e,this),!0)},this.unregisterExtension=function(e){if(!G(e))throw"Illegal argument type: extension name must be a string";let t=!1;for(let n=0;n<o.length;++n){const s=o[n];if(s.name===e){o.splice(n,1),t=!0,this._debug("Unregistered extension",e);const c=s.extension;R(c.unregistered)&&c.unregistered();break}}return t},this.getExtension=e=>{for(let t=0;t<o.length;++t){const n=o[t];if(n.name===e)return n.extension}return null},this.getName=()=>f,this.getClientId=()=>b,this.getURL=()=>{if(l){let e=l.getURL();if(e||(e=I.urls[l.getType()],e))return e}return I.url},this.getTransport=()=>l,this.getConfiguration=function(){return this._mixin(!0,{},I)},this.getAdvice=function(){return this._mixin(!0,{},d)},this.setTimeout=(e,t)=>u.setTimeout(()=>{try{i._debug("Invoking timed function",e),e()}catch(n){i._debug("Exception invoking timed function",e,n)}},t),this.clearTimeout=e=>{u.clearTimeout(e)},window.WebSocket&&this.registerTransport("websocket",new ke),this.registerTransport("long-polling",new ye),this.registerTransport("callback-polling",new we)}const fe=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z",".","-",":","+","=","^","!","/","*","?","&","<",">","(",")","[","]","{","}","@","%","$","#"],Ze=[0,68,0,84,83,82,72,0,75,76,70,65,0,63,62,69,0,1,2,3,4,5,6,7,8,9,64,0,73,66,74,71,81,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,77,0,78,67,0,0,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,79,0,80,0,0];return{CometD:Ve,Transport:Z,RequestTransport:ue,LongPollingTransport:ye,CallbackPollingTransport:we,WebSocketTransport:ke,Utils:J,Z85:{encode:m=>{let u=null;if(m instanceof ArrayBuffer?u=m:m.buffer instanceof ArrayBuffer?u=m.buffer:Array.isArray(m)&&(u=new Uint8Array(m).buffer),u==null)throw"Cannot Z85 encode "+m;const i=u.byteLength,f=i%4,r=4-(f===0?4:f),a=new DataView(u);let l="",_=0;for(let y=0;y<i+r;++y){const b=y>=i;if(_=_*256+(b?0:a.getUint8(y)),(y+1)%4===0){let v=52200625;for(let E=5;E>0;--E){if(!b||E>r){const U=Math.floor(_/v)%85;l+=fe[U]}v/=85}_=0}}return l},decode:m=>{const u=m.length%5,i=5-(u===0?5:u);for(let b=0;b<i;++b)m+=fe[fe.length-1];const f=m.length,r=new ArrayBuffer(f*4/5-i),a=new DataView(r);let l=0,_=0,y=0;for(let b=0;b<f;++b){const v=m.charCodeAt(_++)-32;if(l=l*85+Ze[v],_%5===0){let E=16777216;for(;E>=1;)y<a.byteLength&&a.setUint8(y++,Math.floor(l/E)%256),E/=256;l=0}}return r}}}})})(Te);const bt=Te.exports,wt=xt({__proto__:null,default:bt},[Te.exports]);export{wt as c};
